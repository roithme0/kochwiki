<h2>Rezept erstellen</h2>

<form [formGroup]="recipeForm" action="POST">
  <mat-stepper #stepper>
    <mat-step formGroupName="metaFormGroup" errorMessage="">
      <ng-template matStepLabel></ng-template>

      <div class="meta-fields-wrapper">
        <mat-form-field appearance="fill">
          <mat-label>Name</mat-label>
          <input matInput formControlName="name" />
        </mat-form-field>

        <!-- <div class="field">
        <label
          for="image"
          class="field-label"
          [class.required]="recipeForm.get('image')?.errors?.['required']"
          >Bild</label
        >
        <input
          type="file"
          name="image"
          id="image"
          (change)="onUpload($event, 'image')"
        />
      </div> -->

        <!-- <div class="field">
        <label
        for="original"
        class="field-label"
        [class.required]="recipeForm.get('original')?.errors?.['required']"
        >Original</label
        >
        <input
        type="file"
        name="original"
        id="original"
        (change)="onUpload($event, 'original')"
        />
      </div> -->

        <mat-form-field appearance="fill">
          <mat-label>URL</mat-label>
          <input matInput formControlName="originUrl" />
        </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>Ersteller*in</mat-label>
          <input matInput formControlName="originName" />
        </mat-form-field>
      </div>
    </mat-step>

    <mat-step formGroupName="amountsFormGroup" errorMessage="">
      <ng-template matStepLabel></ng-template>
      <mat-form-field appearance="fill">
        <mat-label>Portionen</mat-label>
        <input matInput type="number" formControlName="servings" />
      </mat-form-field>

      <div formArrayName="amounts" class="amounts-wrapper">
        @for(amount of amounts.controls; track amount){
        <div class="amount-fields-wrapper" formGroupName="{{ $index }}">
          <div class="button-wrapper">
            <mat-icon
              aria-hidden="false"
              aria-label="Löschen"
              fontIcon="close"
              class="button"
              (click)="removeAmount($index)"
            ></mat-icon>
          </div>

          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <mat-panel-title> Zutat </mat-panel-title>
            </mat-expansion-panel-header>

            <mat-form-field appearance="fill">
              <mat-label>Index</mat-label>
              <input matInput type="number" formControlName="index" />
            </mat-form-field>

            <mat-form-field>
              <mat-label>Zutat</mat-label>
              <mat-select
                formControlName="ingredient"
                single
                (change)="onIngredientSelect($event, $index)"
              >
                <mat-option disabled selected></mat-option>
                @for(ingredient of ingredients(); track ingredient.id) {
                <mat-option [value]="ingredient.id">{{
                  ingredient.name
                }}</mat-option
                >}
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="fill">
              <mat-label>Menge [g/ml/Stk.]</mat-label>
              <input matInput type="number" formControlName="amount" />
            </mat-form-field>
          </mat-expansion-panel>
        </div>
        }

        <div class="amount-buttons-wrapper">
          <button mat-stroked-button (click)="addAmount()">
            Zutat hinzufügen
          </button>
          <button mat-stroked-button (click)="openCreateIngredientDialog()">
            Zutat erstellen
          </button>
        </div>
      </div>
    </mat-step>

    <mat-step formGroupName="preparationFormGroup" errorMessage="">
      <ng-template matStepLabel></ng-template>
      <mat-form-field appearance="fill">
        <mat-label>Zubereitungszeit [min]</mat-label>
        <input matInput type="number" formControlName="preptime" />
      </mat-form-field>

      <div formArrayName="steps" class="steps-wrapper">
        @for(step of steps.controls; track step){
        <div formGroupName="{{ $index }}" class="step-fields-wrapper">
          <div class="button-wrapper">
            <mat-icon
              aria-hidden="false"
              aria-label="Löschen"
              fontIcon="close"
              class="button"
              (click)="removeStep($index)"
            ></mat-icon>
          </div>

          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <mat-panel-title> Schritt </mat-panel-title>
            </mat-expansion-panel-header>

            <mat-form-field appearance="fill">
              <mat-label>Index</mat-label>
              <input matInput type="number" formControlName="index" />
            </mat-form-field>
            <mat-form-field appearance="fill">
              <mat-label>Beschreibung</mat-label>
              <input matInput formControlName="description" />
            </mat-form-field>
          </mat-expansion-panel>
        </div>
        }

        <button mat-stroked-button (click)="addStep()">Hinzufügen</button>
      </div>
    </mat-step>

    <mat-step>
      <button
        mat-stroked-button
        type="submit"
        [disabled]="!recipeForm.valid"
        (click)="onSubmit()"
      >
        Rezept erstellen
      </button>
    </mat-step>
  </mat-stepper>
</form>
